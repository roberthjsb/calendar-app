importScripts(
  "https://storage.googleapis.com/workbox-cdn/releases/6.4.1/workbox-sw.js"
);

workbox.loadModule("workbox-background-sync");

const { BackgroundSyncPlugin } = workbox.backgroundSync;

workbox.precaching.precacheAndRoute(self.__WB_MANIFEST);
const { registerRoute } = workbox.routing;
const { CacheFirst, NetworkFirst, NetworkOnly } = workbox.strategies;


const urlNetworkFirst =['/api/auth/renew','/api/event'];
registerRoute(
  ({url})=> urlNetworkFirst.includes(url.pathname),
  new NetworkFirst()
);

const urlcacheFirst =[
    'https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css',
    'https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.0-2/css/all.min.css'
];
registerRoute(
  ({url})=> urlcacheFirst.includes(url.href),
  new CacheFirst()
);

// offline posts
const bgSyncPlugin = new BackgroundSyncPlugin("events-offline", {
  maxRetentionTime: 24 * 60,
});

registerRoute(
  new RegExp("http://localhost:4000/api/event"),
  new NetworkOnly({
    plugins: [bgSyncPlugin],
  }),
  "POST"
);
registerRoute(
  new RegExp("http://localhost:4000/api/event/*"),
  new NetworkOnly({
    plugins: [bgSyncPlugin],
  }),
  "PUT"
);
registerRoute(
  new RegExp("http://localhost:4000/api/event/*"),
  new NetworkOnly({
    plugins: [bgSyncPlugin],
  }),
  "DELETE"
);
